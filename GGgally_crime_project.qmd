---
title: "Indiacrime_project"
---

## Install Packages

```{r}
pacman::p_load(sf, tmap, kableExtra, tidyverse, sfdep, readxl, plyr, Kendall, plotly, dplyr,stringdist)
```

# Aspatial Data Pre-Processing 

## Read Data File (IPC)

```{r}
IPC <- read_xlsx("data/aspatial/1 Districtwise IPC Crimes_2021.xlsx")
```

We remove the first 3 rows as they are just headings and have NA values. We will not be using them anyways.

```{r}
IPC <- IPC %>%
  slice(5:n())
```

Convert to numeric

```{r}
df <- IPC %>%
  select(-c("...1", "...2")) %>%
  mutate_if(is.character,as.numeric)
```

Group data to reduce cardinality

```{r}
temp_df <- df |> rowwise() |>
  summarise(murders = sum(`Murder (Sec.302 IPC)`,`Dowry Deaths (Sec.304-B IPC)`),
            attempted_muders = sum(`Culpable Homicide not amounting to Murder (Sec.304 IPC)`,`Abetment of Suicide (Sec.305/306 IPC)`, `Attempt to Commit Murder (Sec.307 IPC)`, `Attempt to commit Culpable Homicide (Sec.308 IPC)`, `Attempt to Commit Suicide (Sec.309 IPC)`, `Miscarriage, Infanticide, Foeticide and Abandonment (Sec.313 to 318 IPC) \r\n`),
            death_negligence = sum(`Causing Death by Negligence`,`...6`,`...7`,`...8`,`...9`,`...10`,`...11`,`...12`),
            hurt = sum(`Hurt`,`Wrongful Restraint/Confinement (Sec.341 to 348 IPC)`),
            women_assault = `Assault on Women with Intent to Outrage her Modesty`,
            kidnapping_abduction = `Kidnapping and Abduction`,
            human_exploitation = sum(`Human Trafficking (U/S 370)`, `Exploitation of Trafficked Person 370A IPC)`, `Selling of Minors for Prostitution (Sec.372 IPC)`, `Buying of Minors for Prostitution (Sec.373 IPC)`, `Rape (Sec.376 IPC)`, `Attempt to Commit Rape (Sec.376/511 IPC)`, `Unnatural Offences (Sec.377 IPC)`),
            state_offence = `...64`,
            public_tranquility = `Offences against Public Tranquillity (Total)`,
            movable_property = `Offences against Property (Total)`,
            document_fraud = `Offences Relating to Documents & Property Marks (Total)`,
            miscellaneous = sum(`Miscellaneous IPC Crimes(Total)`, `...143`))
```

Join into df

```{r}
df <- cbind(IPC$"...1", IPC$"...2", temp_df) %>%
       rename("State" = "IPC$...1",
              "District" = "IPC$...2")
```

Save as rds

```{r}
write_rds(df, "data/rds/IPC.rds")
```

Read IPC rds file

```{r}
IPC_new <- read_rds("data/rds/IPC.rds")
```

## Read Data File (SLL)

```{r}
SLL <- read_xlsx("data/aspatial/2 Districtwise SLL Crimes_2021.xlsx") %>%
  slice(5:n())
```

```{r}
df <- SLL %>%
  select(-c("...1", "...2")) %>%
  mutate_if(is.character,as.numeric)
```

Group data to reduce cardinality

```{r}
temp_df <- df |> rowwise() |>
  summarise(women = `...7`,
            children = `...14`,
            st_sc = `...19`,
            state = `...23`,
            arms_related = `...31`,
            information_infringement = `...35`,
            trade_finance = `...42`,
            narcotics = `...48`,
            environment = `...56`,
            foreigner = `...61`,
            railway = `...64`,
            media = `...69`,
            food = `...73`,
            others = sum(`...91`, `Other SLL Crimes`))
```

Join into df

```{r}
df <- cbind(SLL$"...1", SLL$"...2", temp_df) %>%
       rename("State" = "SLL$...1",
              "District" = "SLL$...2")
```

Save as rds

```{r}
write_rds(df, "data/rds/SLL.rds")
```

Read SLL rds file

```{r}
SLL_new <- read_rds("data/rds/SLL.rds")
```

# Geospatial Data Pre-Processing 

## Read Data File (India District level)

```{r}
India_District <- st_read(dsn = "data/geospatial/data (1)", layer="polbnda_ind")
```

```{r}
India_District_2 <- st_read(dsn = "data/geospatial/India District", layer="output")
```

```{r}
st_crs(India_District)
st_crs(India_District_2)
```

```{r}
#transform WGS84 to ESPG code 3149 (india)
India_District <- st_transform(India_District, 3149)
st_crs(India_District)

India_District_2 <- st_transform(India_District_2, 3149)
st_crs(India_District_2)

```

```{r}
plot(st_geometry(India_District))
plot(st_geometry(India_District_2))
```

```{r}
tm_shape(India_District) + 
  tm_polygons("laa")
```

```{r}
tm_shape(India_District_2) + 
  tm_polygons("statename")
```

```{r}
tm_shape(India_District) + 
  tm_polygons("nam")
```

Joining Aspatial and Geospatial Data files

```{r}
colnames(India_District)
```

```{r}
colnames(India_District_2)
```

```{r}
colnames(IPC_new)
```

```{r}
combined_India_districtlevels <- left_join(India_District, IPC_new,by=c(
                                "laa"="District"))
```

```{r}
combined_India_districtlevels2 <- left_join(IPC_new, India_District_2,by=c(
                                "District"="distname"))
```

Visualise our joined data file

```{r}
combined_India_districtlevels2 <- st_as_sf(combined_India_districtlevels2)

prelim_Unvaccinated = tm_shape(combined_India_districtlevels2)+
  tm_fill("District") +
  tm_borders(alpha = 0.2) +
  tm_layout(main.title="Preliminary Unvaccinated Count")

prelim_Unvaccinated
```
